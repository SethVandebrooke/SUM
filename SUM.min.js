function SUM(t,n){function r(t){return(new(function(){function t(){}return t.hash=function(e,n){var r={msgFormat:"string",outFormat:"hex"},o=Object.assign(r,n)
switch(o.msgFormat){default:case"string":e=function(t){try{return(new TextEncoder).encode(t,"utf-8").reduce(function(t,e){return t+String.fromCharCode(e)},"")}catch(e){return unescape(encodeURIComponent(t))}}(e)
break
case"hex-bytes":e=function(t){var e=t.replace(" ","")
return""==e?"":e.match(/.{2}/g).map(function(t){return String.fromCharCode(parseInt(t,16))}).join("")}(e)}var a=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],i=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]
e+=String.fromCharCode(128)
for(var s=e.length/4+2,u=Math.ceil(s/16),l=new Array(u),c=0;u>c;c++){l[c]=new Array(16)
for(var d=0;16>d;d++)l[c][d]=e.charCodeAt(64*c+4*d+0)<<24|e.charCodeAt(64*c+4*d+1)<<16|e.charCodeAt(64*c+4*d+2)<<8|e.charCodeAt(64*c+4*d+3)<<0}var g=8*(e.length-1)/Math.pow(2,32),f=8*(e.length-1)>>>0
l[u-1][14]=Math.floor(g),l[u-1][15]=f
for(var c=0;u>c;c++){for(var p=new Array(64),h=0;16>h;h++)p[h]=l[c][h]
for(var h=16;64>h;h++)p[h]=t.a1(p[h-2])+p[h-7]+t.a0(p[h-15])+p[h-16]>>>0
for(var m=i[0],v=i[1],b=i[2],S=i[3],w=i[4],A=i[5],U=i[6],M=i[7],h=0;64>h;h++){var y=M+t.a1(w)+t.Ch(w,A,U)+a[h]+p[h],C=t.a0(m)+t.Maj(m,v,b)
M=U,U=A,A=w,w=S+y>>>0,S=b,b=v,v=m,m=y+C>>>0}i[0]=i[0]+m>>>0,i[1]=i[1]+v>>>0,i[2]=i[2]+b>>>0,i[3]=i[3]+S>>>0,i[4]=i[4]+w>>>0,i[5]=i[5]+A>>>0,i[6]=i[6]+U>>>0,i[7]=i[7]+M>>>0}for(var M=0;M<i.length;M++)i[M]=("00000000"+i[M].toString(16)).slice(-8)
var x="hex-w"==o.outFormat?" ":""
return i.join(x)},t.ROTR=function(t,e){return e>>>t|e<<32-t},t.a0=function(e){return t.ROTR(2,e)^t.ROTR(13,e)^t.ROTR(22,e)},t.a1=function(e){return t.ROTR(6,e)^t.ROTR(11,e)^t.ROTR(25,e)},t.a0=function(e){return t.ROTR(7,e)^t.ROTR(18,e)^e>>>3},t.a1=function(e){return t.ROTR(17,e)^t.ROTR(19,e)^e>>>10},t.Ch=function(t,e,n){return t&e^~t&n},t.Maj=function(t,e,n){return t&e^t&n^e&n},t}())).__proto__.constructor.hash(t)}function o(t,e,n){if(t)if("string"==typeof t)window.location.href=t
else if("function"==typeof t){var r={data:e,message:n}
t(r)}}var a=this
t=t||{},a.name=t.name||"defaultApp",a.uid=t.uid||"username",null!=localStorage.getItem(a.name+"uid")&&(a.uid=localStorage.getItem(a.name+"uid")),a.Q=function(t){return document.querySelectorAll(t)},a.extentions=null,a.files=null
var i
a.users=function(){function t(t){if(this.name=t,this.dataSystem={set:function(t,e){return localStorage.setItem(t,e)},get:function(t){return localStorage.getItem(t)}},this.name=t,null==this.dataSystem.get(t)){var e=new Array
this.dataSystem.set(t,JSON.stringify(e))}this.debug=!1,this.add=function(t){var e=JSON.parse(this.dataSystem.get(this.name))
e.push(t),this.dataSystem.set(this.name,JSON.stringify(e)),!0===this.debug&&console.log(this.name+" -> add: Object successfully added!"),a.event("SUM","storage",this.name,"add").broadcast({input:t,output:null}),a.event("SUM","storage","add").broadcast({input:t,output:null})},this.exists=function(t,e){var n=JSON.parse(this.dataSystem.get(this.name))
if(n.length>0){for(var r=0;r<n.length;r++){if(n[r][t]==e)return!0===this.debug&&console.log(this.name+" -> exists: returned true"),!0}this.dataSystem.set(this.name,JSON.stringify(n))}else!0===this.debug&&console.log(this.name+" -> exists: No objects are stored!")},this.edit=function(t,e,n,r){var o=JSON.parse(this.dataSystem.get(this.name))
if(o.length>0){for(var i=0;i<o.length;i++){var s=o[i]
s[t]==e&&(!0===this.debug&&(console.log(this.name+" -> edit: Object before - "),console.log(s)),s[n]=r,!0===this.debug&&(console.log(this.name+" -> edit: Object after - "),console.log(s)),o[i]=s,!0===this.debug&&console.log(this.name+" -> edit: Object saved!")),a.event("SUM","storage",this.name,"exists").broadcast({input:arguments,output:s}),a.event("SUM","storage","exists").broadcast({input:arguments,output:s})}this.dataSystem.set(this.name,JSON.stringify(o))}else!0===this.debug&&console.log(this.name+" -> edit: No objects are stored!")
a.event("SUM","storage",this.name,"exists").broadcast({input:arguments,output:!1}),a.event("SUM","storage","exists").broadcast({input:arguments,output:!1})},this.remove=function(t,e){var n=JSON.parse(this.dataSystem.get(this.name))
if(n.length>0){for(var r=0;r<n.length;r++){var o=n[r]
o[t]==e&&(!0===this.debug&&(console.log(this.name+" -> remove: Object matched for removal -"),console.log(o)),n.splice(r,1),!0===this.debug&&console.log(this.name+" -> remove: Object deleted!")),a.event("SUM","storage",this.name,"remove").broadcast({input:arguments,output:o}),a.event("SUM","storage","remove").broadcast({input:arguments,output:o})}this.dataSystem.set(this.name,JSON.stringify(n))}else!0===this.debug&&console.log(this.name+" -> remove: No objects are stored!")
a.event("SUM","storage",this.name,"remove").broadcast({input:arguments,output:!1}),a.event("SUM","storage","remove").broadcast({input:arguments,output:!1})},this.get=function(t,e){for(var n=JSON.parse(this.dataSystem.get(this.name)),r=0;r<n.length;r++){var o=n[r]
if(o[t]==e)return!0===this.debug&&(console.log(this.name+" -> get: Object found! "),console.log(o)),o}return a.event("SUM","storage",this.name,"get").broadcast({input:arguments,output:o}),a.event("SUM","storage","get").broadcast({input:arguments,output:o}),!0===this.debug&&console.log(this.name+" -> get: Object not found!"),n.length<1&&!0===this.debug&&console.log(this.name+" -> get: No objects, with the property of "+t+", matched "+e),null},this.listAll=function(){var t=JSON.parse(this.dataSystem.get(this.name))
return a.event("SUM","storage",this.name,"listAll").broadcast({input:arguments,output:t}),a.event("SUM","storage","listAll").broadcast({input:arguments,output:t}),t.length<1&&!0===this.debug&&console.log(this.name+" -> listAll: There are no stored objects to return!"),!0===this.debug&&(console.log(this.name+" -> listAll: Objects were found!"),console.log(t)),t},this.clear=function(){a.event("SUM","storage",this.name,"clear","before").broadcast({input:arguments,output:null}),a.event("SUM","storage","clear","before").broadcast({input:arguments,output:null}),this.dataSystem.clear(),a.event("SUM","storage",this.name,"clear","after").broadcast({input:arguments,output:null}),a.event("SUM","storage","clear","after").broadcast({input:arguments,output:null})},this.update=function(t,e,n){for(var r in n)this.edit(t,e,r,n[r])
a.event("SUM","storage",this.name,"update").broadcast({input:arguments,output:null}),a.event("SUM","storage","update").broadcast({input:arguments,output:null})},this.filter=function(t){var e=this.listAll().filter(t)
return a.event("SUM","storage",this.name,"filter").broadcast({input:arguments,output:e}),a.event("SUM","storage","filter").broadcast({input:arguments,output:e}),e},this.getFormData=function(t){var e={},n=t.elements
for(var r in n){var o=n[r],a=n[r].tagName,i=n[r].name
if("INPUT"==a||"SELECT"==a||"TEXTAREA"==a){var s=a+r,u=i||(o.id||s)
u.toLowerCase().match("submit")||u.toLowerCase().match("confirm")||(e[u]=o.value)}}return e},this.addFromForm=function(t){var e=this.getFormData(t)
e.createdOn=new Date,e.lastUpdated=new Date,e.guid=btoa(1e8*math.random()+""),e.createdBy=a.currentUser().guid,this.add(e)},this.attatchToForm=function(t){var e=this,n=t.getAttribute("method")
if("add"==n)t.addEventListener("submit",function(t){t.preventDefault(),e.addFromForm(t.target)})
else if("update"==n&&(t.addEventListener("submit",function(t){t.preventDefault()
var n=t.target.getAttribute("field"),r=t.target.getAttribute("value")
e.updateForm(t.target,n,r)}),"true"==t.getAttribute("prefill"))){var r=t.getAttribute("field"),o=t.getAttribute("value")
this.prefillForm(t,this.get(r,o))}},this.prefillForm=function(t,e){for(var n in e)t.querySelectorAll("#"+n+", [name='"+n+"']").forEach(function(t){"password"!=n&&(t.value=e[n])})},this.updateForm=function(t,e,n){var t=this.getFormData(t)
for(var r in t)this.edit(e,n,r,t[r])}}return a.files=new t(a.name+"-files"),a.extentions=new t(a.name+"-extensions"),document.querySelectorAll("form").forEach(function(e){var n=e.getAttribute("store-as")||!1
if(n){new t(n).attatchToForm(e)}}),i=t,new t(a.name+"-app-data")}(),a.extentions.Update=function(t){a.extentions.update("name",t.name,t)},a.event=function(){var t={}
return function(){var e=Array.from(arguments),n=1===e.length,r=e.join("/")
return t.hasOwnProperty(r)||(t[r]=[]),{listen:function(e){return t[r].push(e),e},broadcast:function(){var e=Array.from(arguments)
for(var o in t)n?o!==r&&null===o.match(r+"/")||t[o].forEach(function(t){t.apply(null,e)}):null!==o.match(r)&&t[o].forEach(function(t){t.apply(null,e)})},stopListening:function(e){for(var n in t)if(null!==n.match(r))for(var o in t[r])e.toString()==t[r][o].toString()&&t[r].splice(o,1)}}}}(),a.signup=function(t,e,n){if(!t[a.uid])throw o(n,t,"Invalid submission. "+a.uid+" required."),a.event("SUM","users","signup").broadcast({input:arguments,output:!1}),new Error(name+" -> Register: "+a.uid+" must be defined.")
if(!t.password)throw o(n,t,"Invalid submission. Password required."),a.event("SUM","users","signup").broadcast({input:arguments,output:!1}),new Error(name+" -> Register: 'password' is a required property")
a.users.exists(a.uid,t[a.uid])?(o(n,t,"That "+a.uid+" is already in use!"),a.event("SUM","users","signup").broadcast({input:arguments,output:!1})):(t.password=r(t.password),t.joinedOn=new Date,t.lastUpdated=new Date,t.guid=btoa(""+1e12*Math.random()),a.users.add(t),sessionStorage.setItem(name+"-current-user",t.guid),o(e,t),a.event("SUM","users","signup").broadcast({input:arguments,output:t}))},a.update=function(t,e,n){for(var i in t)"password"==i?a.users.edit("guid",e,i,r(t[i])):a.users.edit("guid",e,i,t[i])
a.users.edit("guid",e,"lastUpdated",new Date),o(n,t,"Successfully updated user!"),a.event("SUM","users","update").broadcast({input:arguments,output:t})},a.auth=function(t,e,n){if(!t[a.uid])throw o(n,t,"Invalid authentication attempt. "+a.uid+" required."),a.event("SUM","users","authenticate").broadcast({input:arguments,output:!1}),new Error(name+" -> Auth: "+a.uid+" must be defined.")
if(!t.password)throw o(n,t,"Invalid authentication attempt. Password required."),a.event("SUM","users","authenticate").broadcast({input:arguments,output:!1}),new Error(name+" -> Auth: 'password' is a required property")
a.users.exists(a.uid,t[a.uid])?a.users.get(a.uid,t[a.uid]).password==r(t.password)?(o(e,t),a.event("SUM","users","authenticate").broadcast({input:arguments,output:t})):(o(n,t,"Incorrect password!"),a.event("SUM","users","authenticate").broadcast({input:arguments,output:!1})):(o(n,t,"User does not exist!"),a.event("SUM","users","authenticate").broadcast({input:arguments,output:!1}))},a.login=function(t,e,n){a.auth(t,function(t){var n=a.users.get(a.uid,t.data[a.uid])
sessionStorage.setItem(name+"-current-user",n.guid),o(e,t.data,"Login successfull!"),a.event("SUM","users","login").broadcast({input:arguments,output:t})},function(t){o(n,t.data,"Login failed!"),a.event("SUM","users","login").broadcast({input:arguments,output:!1})})},a.logout=function(t){sessionStorage.removeItem(name+"-current-user"),window.location.href=t,a.event("SUM","users","logout").broadcast({input:arguments,output:null})},a.loggedInAs=function(){return sessionStorage.getItem(name+"-current-user")||"User"},a.loggedIn=function(){return null!=sessionStorage.getItem(name+"-current-user")},a.currentUser=function(){return a.users.get("guid",a.loggedInAs())},a.deleteUserAccount=function(t,e,n){a.auth(t,function(t){sessionStorage.setItem(name+"-current-user",t.data[a.uid]),a.users.remove(a.uid,t[a.uid]),o(e,t.data,"User deleted!"),a.event("SUM","users","delete").broadcast({input:arguments,output:t})},function(t){o(n,t.data,"User does not exist!"),a.event("SUM","users","delete").broadcast({input:arguments,output:!1})})},a.getProfilePictureData=function(t){return localStorage.getItem(a.name+"-profilepic-"+(t||a.loggedInAs()))||!1},a.reset=function(){localStorage.clear(),sessionStorage.clear(),window.location.href=window.location.href,a.event("SUM","reset").broadcast({input:arguments,output:null})},a.setSecurityQuestion=function(t,e){var n=a.loggedInAs()
return!!n&&(a.users.update("guid",n,"SQ",t),a.users.update("guid",n,"SQA",r(e)),a.event("SUM","users","setSecurityQuestion").broadcast({input:arguments,output:!0}),!0)},a.forgotPassword=function(t,e,n,i,s){if(a.users.exists(a.uid,t)){var u=a.users.get(a.uid,t)
u.SQA===r(e)?(a.users.update(a.uid,t,"password",n),u=a.users.get(a.uid,t),o(i,u,"Successfully changed password!"),a.event("SUM","users","forgotPassword").broadcast({input:arguments,output:u})):(o(s,{},"Wrong answer."),a.event("SUM","users","forgotPassword").broadcast({input:arguments,output:!1}))}else o(s,{},"That "+a.uid+" isn't used in this application."),a.event("SUM","users","forgotPassword").broadcast({input:arguments,output:!1})},a.getForm=function(t){var e={},n=t.elements
for(var r in n){var o=n[r],a=n[r].tagName,i=n[r].name
if("INPUT"==a||"SELECT"==a||"TEXTAREA"==a){var s=a+r,u=i||(o.id||s)
u.toLowerCase().match("submit")||u.toLowerCase().match("confirm")||(e[u]=o.value)}}return e},a.newComponent=function(t,e,n,r){a.Q(e).forEach(function(t){n(t)})
var o={name:t,id:btoa(t+e+Math.floor(1e3*Math.random())),selector:e,operation:n.toString(),description:r||""}
a.extentions.exists("name",t)?a.extentions.exists("name",t)&&(a.extentions.Update(o),a.event("SUM","updateComponent").broadcast({input:arguments,output:o})):(a.extentions.add(o),a.event("SUM","newComponent").broadcast({input:arguments,output:o}))}
var s={}
a.generateView=function(t,e,n){s[t]?n=s[t]:(n=n||(t.innerHTML||""),s[t]=n),t.innerHTML="",e=e||[],e.forEach(function(e){var r=n
for(var o in e)r=r.split("$"+o).join(e[o])
t.innerHTML+=r}),a.event("SUM","users","generateView").broadcast({input:arguments,output:null}),t.querySelectorAll("[from-storage]").forEach(function(t){var e=new i(t.tagName)
a.generateView(t,e.listAll())})},a.parseURL=function(t){var e=window.location.href,n={}
if("check"===(t=t&&("?"===t||"#"===t)?t:"check")&&!1===(t=e.includes("?")?"?":!!e.includes("#")&&"#"))return!1
if(e=e.substring(e.indexOf(t)+1,e.length),e.includes("=")){var r=e.split("&")
return r.forEach(function(t){n[t.split("=")[0]]=t.split("=")[1]}),r[0].split("=").length>1?n:e}return e},a.searchContext=function(t,n){function r(t,e){return t=t.toLowerCase(),e=e.toLowerCase(),t.split(e).length-1}var o=n?n.innerHTML:"",a=window.location.href,i=document.querySelector("title")
i=null!=i?i.innerHTML:""
var s=0
s=5*r(a,t),s+=3*r(e?e.getAttribute("id"):"",t),s+=3*r(o,t),s+=4*r(i,t)
var u=0
document.body.querySelectorAll("h1,h2,h3,h4,h5,h6").forEach(function(e){u+=r(e.innerHTML,t)}),u*=2
var l=0
return document.body.querySelectorAll("p").forEach(function(e){l+=r(e.innerHTML,t)}),s+=u+l},a.run=function(){function t(t,n){a.files.exists("name",e.name)?a.files.edit("name",e.name,t,n):a.files.add(e)}a.event("SUM","run","before").broadcast({input:arguments,output:null})
var e=function(){var t=window.location.href
t=t.split("/")
var e=t[t.length-2]
return t=t[t.length-1],t=t.split("#")[0],{name:t.split("?")[0],folder:e,forms:""}}()
t("folder",e.folder)
var n=[]
a.newComponent("from-url","[from-url]",function(t){var e=t.getAttribute("from-url"),n=e.split(/\s/).join("").split(","),r=a.parseURL()
n.forEach(function(e){var n=e.split(":")
"text"==n[0]?t.innerHTML=r[n[1]]:t.setAttribute(n[0],r[n[1]])})},'Set attributes to values defined in the URL. Syntax: "attribute: value, attribute: value".')
var r=document.querySelectorAll("form")
r.forEach(function(t){var e=t.getAttribute("type")
if(null==e&&1===r.length){var o=a.searchContext("login",t)+a.searchContext("signin",t)+a.searchContext("sign in",t),i=a.searchContext("singup",t)+a.searchContext("sing up",t)+a.searchContext("register",t),s=a.searchContext("update",t)+a.searchContext("edit",t)+a.searchContext("change",t)
return void(o>i&&o>s?(e="login",console.log("Deduced: ",e)):i>o&&i>s?(e="signup",console.log("Deduced: ",e)):s>i&&s>o?(e="update",console.log("Deduced: ",e)):o===i?t.querySelectorAll("input").length>3?(e="signup",console.log("Deduced: ",e)):(e="login",console.log("Deduced: ",e)):console.log("SUM is unsure as to what this form is intended for: ",t))}if("signup"===e&&localStorage.setItem(name+"-blueprint",JSON.stringify(a.getForm(t))),t.addEventListener("submit",function(n){var r=a.getForm(t),o=t.getAttribute("uid")
null!=o&&(a.uid=o,localStorage.setItem(a.name+"uid",o)),"login"===e||"signup"===e?(n.preventDefault(),a[e](r,t.getAttribute("on-success")||window.location.href,t.getAttribute("on-fail")||window.location.href)):"update"===e&&(n.preventDefault(),a.update(r,a.loggedInAs(),t.getAttribute("on-success")||window.location.href))}),"update"===e){var u=a.currentUser()
for(var l in u)t.querySelectorAll("#"+l+", [name='"+l+"']").forEach(function(t){"password"!=l&&t.setAttribute("value",u[l])})}var c=[],d=a.getForm(t)
for(var l in d)c.push(l)
n.push({type:e,fields:c})}),t("forms",JSON.stringify(n)),a.newComponent("Logout","[logout]",function(t){t.addEventListener("click",function(e){a.logout(t.getAttribute("logout")||window.location.href)})},"Logout the user when clicked."),a.newComponent("Delete User","[delete-user-account]",function(t){a.deleteUserAccount(t.getAttribute("delete-user-account")?t.getAttribute("delete-user-account"):a.loggedInAs(),t.getAttribute("on-success")||window.location.href,t.getAttribute("on-fail")||window.location.href)},"Delete user account when clicked.")
var o=a.currentUser()
for(var s in o)a.newComponent(s,s,function(t){t.innerHTML=o[s]},"Display "+s+" value of the user that is logged in.")
a.newComponent("Display Users","users",function(t){a.generateView(t,a.users.listAll())},"For each user, display the innerHTML of the given element after replacing each $propertyName with its value."),a.newComponent("Display stored data","[from-storage]",function(t){var e=new i(t.tagName)
a.generateView(t,e.listAll())},"For each object stored in the given collection, display the innerHTML of the given element after replacing each $propertyName with its value."),a.newComponent("App name","app-name",function(t){t.innerHTML=a.name},"Display app name.")
var u=function(t){var e=t.target,n=new FileReader
n.onload=function(){var t=n.result
localStorage.setItem(a.name+"-profilepic-"+a.loggedInAs(),t),a.Q("[profile-pic=''], [profile-pic='"+a.loggedInAs()+"']").forEach(function(e){e.setAttribute("src",t)})},n.readAsDataURL(e.files[0])}
a.newComponent("Upload Profile Picture","[upload='profile-pic']",function(t){t.setAttribute("type","file"),t.setAttribute("accept","image/*"),t.addEventListener("change",function(t){u(t)})},"Set up the given input element to upload the profile picture for the user that is logged in."),a.newComponent("Profile Picture","[profile-pic]",function(t){var e,n=t.getAttribute("profile-pic")||!1
e=""==n?a.loggedInAs():a.users.exists(a.uid,n)?a.users.get(a.uid,n).guid:"",a.getProfilePictureData(e)&&t.setAttribute("src",a.getProfilePictureData(e))},"Display profile picture for the user that is specified, or if set to nothing the user that is logged in."),a.event("SUM","run","after").broadcast({input:arguments,output:null})},a.Q("html")[0].getAttribute("require-login")&&(a.loggedIn()||(window.location.href=t.loggedOut?t.loggedOut:a.Q("html")[0].getAttribute("require-login"))),a.Q("html")[0].getAttribute("logged-in")&&a.loggedIn()&&(window.location.href=t.loggedIn?t.loggedIn:a.Q("html")[0].getAttribute("logged-in")),void 0===n&&this.run()}window.app=new SUM
