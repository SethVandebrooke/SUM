function SUM(e,t){function n(e){return(new(function(){function e(){}return e.hash=function(t,n){var r={msgFormat:"string",outFormat:"hex"},i=Object.assign(r,n)
switch(i.msgFormat){default:case"string":t=function(e){try{return(new TextEncoder).encode(e,"utf-8").reduce(function(e,t){return e+String.fromCharCode(t)},"")}catch(t){return unescape(encodeURIComponent(e))}}(t)
break
case"hex-bytes":t=function(e){var t=e.replace(" ","")
return""==t?"":t.match(/.{2}/g).map(function(e){return String.fromCharCode(parseInt(e,16))}).join("")}(t)}var o=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],u=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]
t+=String.fromCharCode(128)
for(var s=t.length/4+2,a=Math.ceil(s/16),l=new Array(a),g=0;a>g;g++){l[g]=new Array(16)
for(var c=0;16>c;c++)l[g][c]=t.charCodeAt(64*g+4*c+0)<<24|t.charCodeAt(64*g+4*c+1)<<16|t.charCodeAt(64*g+4*c+2)<<8|t.charCodeAt(64*g+4*c+3)<<0}var d=8*(t.length-1)/Math.pow(2,32),f=8*(t.length-1)>>>0
l[a-1][14]=Math.floor(d),l[a-1][15]=f
for(var g=0;a>g;g++){for(var p=new Array(64),h=0;16>h;h++)p[h]=l[g][h]
for(var h=16;64>h;h++)p[h]=e.a1(p[h-2])+p[h-7]+e.a0(p[h-15])+p[h-16]>>>0
for(var m=u[0],v=u[1],S=u[2],w=u[3],b=u[4],A=u[5],U=u[6],M=u[7],h=0;64>h;h++){var y=M+e.a1(b)+e.Ch(b,A,U)+o[h]+p[h],C=e.a0(m)+e.Maj(m,v,S)
M=U,U=A,A=b,b=w+y>>>0,w=S,S=v,v=m,m=y+C>>>0}u[0]=u[0]+m>>>0,u[1]=u[1]+v>>>0,u[2]=u[2]+S>>>0,u[3]=u[3]+w>>>0,u[4]=u[4]+b>>>0,u[5]=u[5]+A>>>0,u[6]=u[6]+U>>>0,u[7]=u[7]+M>>>0}for(var M=0;M<u.length;M++)u[M]=("00000000"+u[M].toString(16)).slice(-8)
var O="hex-w"==i.outFormat?" ":""
return u.join(O)},e.ROTR=function(e,t){return t>>>e|t<<32-e},e.a0=function(t){return e.ROTR(2,t)^e.ROTR(13,t)^e.ROTR(22,t)},e.a1=function(t){return e.ROTR(6,t)^e.ROTR(11,t)^e.ROTR(25,t)},e.a0=function(t){return e.ROTR(7,t)^e.ROTR(18,t)^t>>>3},e.a1=function(t){return e.ROTR(17,t)^e.ROTR(19,t)^t>>>10},e.Ch=function(e,t,n){return e&t^~e&n},e.Maj=function(e,t,n){return e&t^e&n^t&n},e}())).__proto__.constructor.hash(e)}function r(e,t,n){if(e)if("string"==typeof e)window.location.href=e
else if("function"==typeof e){var r={data:t,message:n}
e(r)}}var i=this
e=e||{},i.name=e.name||"defaultApp",i.uid=e.uid||"username",null!=localStorage.getItem(i.name+"uid")&&(i.uid=localStorage.getItem(i.name+"uid")),i.Q=function(e){return document.querySelectorAll(e)},i.extentions=null,i.files=null
var o
i.users=function(){function e(e){if(this.name=e,this.dataSystem={set:function(e,t){return localStorage.setItem(e,t)},get:function(e){return localStorage.getItem(e)}},this.name=e,null==this.dataSystem.get(e)){var t=new Array
this.dataSystem.set(e,JSON.stringify(t))}this.debug=!1,this.add=function(e){var t=JSON.parse(this.dataSystem.get(this.name))
t.push(e),this.dataSystem.set(this.name,JSON.stringify(t)),!0===this.debug&&console.log(this.name+" -> add: Object successfully added!"),i.event("SUM","storage",this.name,"add").trigger({input:e,output:null}),i.event("SUM","storage","add").trigger({input:e,output:null})},this.exists=function(e,t){var n=JSON.parse(this.dataSystem.get(this.name))
if(n.length>0){for(var r=0;r<n.length;r++){if(n[r][e]==t)return!0===this.debug&&console.log(this.name+" -> exists: returned true"),!0}this.dataSystem.set(this.name,JSON.stringify(n))}else!0===this.debug&&console.log(this.name+" -> exists: No objects are stored!")},this.edit=function(e,t,n,r){var o=JSON.parse(this.dataSystem.get(this.name))
if(o.length>0){for(var u=0;u<o.length;u++){var s=o[u]
s[e]==t&&(!0===this.debug&&(console.log(this.name+" -> edit: Object before - "),console.log(s)),s[n]=r,!0===this.debug&&(console.log(this.name+" -> edit: Object after - "),console.log(s)),o[u]=s,!0===this.debug&&console.log(this.name+" -> edit: Object saved!")),i.event("SUM","storage",this.name,"exists").trigger({input:arguments,output:s}),i.event("SUM","storage","exists").trigger({input:arguments,output:s})}this.dataSystem.set(this.name,JSON.stringify(o))}else!0===this.debug&&console.log(this.name+" -> edit: No objects are stored!")
i.event("SUM","storage",this.name,"exists").trigger({input:arguments,output:!1}),i.event("SUM","storage","exists").trigger({input:arguments,output:!1})},this.remove=function(e,t){var n=JSON.parse(this.dataSystem.get(this.name))
if(n.length>0){for(var r=0;r<n.length;r++){var o=n[r]
o[e]==t&&(!0===this.debug&&(console.log(this.name+" -> remove: Object matched for removal -"),console.log(o)),n.splice(r,1),!0===this.debug&&console.log(this.name+" -> remove: Object deleted!")),i.event("SUM","storage",this.name,"remove").trigger({input:arguments,output:o}),i.event("SUM","storage","remove").trigger({input:arguments,output:o})}this.dataSystem.set(this.name,JSON.stringify(n))}else!0===this.debug&&console.log(this.name+" -> remove: No objects are stored!")
i.event("SUM","storage",this.name,"remove").trigger({input:arguments,output:!1}),i.event("SUM","storage","remove").trigger({input:arguments,output:!1})},this.get=function(e,t){for(var n=JSON.parse(this.dataSystem.get(this.name)),r=0;r<n.length;r++){var o=n[r]
if(o[e]==t)return!0===this.debug&&(console.log(this.name+" -> get: Object found! "),console.log(o)),o}return i.event("SUM","storage",this.name,"get").trigger({input:arguments,output:o}),i.event("SUM","storage","get").trigger({input:arguments,output:o}),!0===this.debug&&console.log(this.name+" -> get: Object not found!"),n.length<1&&!0===this.debug&&console.log(this.name+" -> get: No objects, with the property of "+e+", matched "+t),null},this.listAll=function(){var e=JSON.parse(this.dataSystem.get(this.name))
return i.event("SUM","storage",this.name,"listAll").trigger({input:arguments,output:e}),i.event("SUM","storage","listAll").trigger({input:arguments,output:e}),e.length<1&&!0===this.debug&&console.log(this.name+" -> listAll: There are no stored objects to return!"),!0===this.debug&&(console.log(this.name+" -> listAll: Objects were found!"),console.log(e)),e},this.clear=function(){i.event("SUM","storage",this.name,"clear","before").trigger({input:arguments,output:null}),i.event("SUM","storage","clear","before").trigger({input:arguments,output:null}),this.dataSystem.clear(),i.event("SUM","storage",this.name,"clear","after").trigger({input:arguments,output:null}),i.event("SUM","storage","clear","after").trigger({input:arguments,output:null})},this.update=function(e,t,n){for(var r in n)this.edit(e,t,r,n[r])
i.event("SUM","storage",this.name,"update").trigger({input:arguments,output:null}),i.event("SUM","storage","update").trigger({input:arguments,output:null})},this.filter=function(e){var t=this.listAll().filter(e)
return i.event("SUM","storage",this.name,"filter").trigger({input:arguments,output:t}),i.event("SUM","storage","filter").trigger({input:arguments,output:t}),t},this.getFormData=function(e){var t={},n=e.elements
for(var r in n){var i=n[r],o=n[r].tagName,u=n[r].name
if("INPUT"==o||"SELECT"==o||"TEXTAREA"==o){var s=o+r,a=u||(i.id||s)
a.toLowerCase().match("submit")||a.toLowerCase().match("confirm")||(t[a]=i.value)}}return t},this.addFromForm=function(e){var t=this.getFormData(e)
t.createdOn=new Date,t.lastUpdated=new Date,t.guid=btoa(1e8*math.random()+""),t.createdBy=i.currentUser().guid,this.add(t)},this.attatchToForm=function(e){var t=this,n=e.getAttribute("method")
if("add"==n)e.addEventListener("submit",function(e){e.preventDefault(),t.addFromForm(e.target)})
else if("update"==n&&(e.addEventListener("submit",function(e){e.preventDefault()
var n=e.target.getAttribute("field"),r=e.target.getAttribute("value")
t.updateForm(e.target,n,r)}),"true"==e.getAttribute("prefill"))){var r=e.getAttribute("field"),i=e.getAttribute("value")
this.prefillForm(e,this.get(r,i))}},this.prefillForm=function(e,t){for(var n in t)e.querySelectorAll("#"+n+", [name='"+n+"']").forEach(function(e){"password"!=n&&(e.value=t[n])})},this.updateForm=function(e,t,n){var e=this.getFormData(e)
for(var r in e)this.edit(t,n,r,e[r])}}return i.files=new e(i.name+"-files"),i.extentions=new e(i.name+"-extensions"),document.querySelectorAll("form").forEach(function(t){var n=t.getAttribute("store-as")||!1
if(n){new e(n).attatchToForm(t)}}),o=e,new e(i.name+"-app-data")}(),i.extentions.Update=function(e){i.extentions.update("name",e.name,e)},i.event=function(){var e={}
return function(){var t=Array.from(arguments),n=1===t.length,r=t.join("/")
return e.hasOwnProperty(r)||(e[r]=[]),{listen:function(t){return e[r].push(t),t},broadcast:function(){var t=Array.from(arguments)
for(var i in e)n?i!==r&&null===i.match(r+"/")||e[i].forEach(function(e){e.apply(null,t)}):null!==i.match(r)&&e[i].forEach(function(e){e.apply(null,t)})},stopListening:function(t){for(var n in e)if(null!==n.match(r))for(var i in e[r])t.toString()==e[r][i].toString()&&e[r].splice(i,1)}}}}(),i.signup=function(e,t,o){if(!e[i.uid])throw r(o,e,"Invalid submission. "+i.uid+" required."),i.event("SUM","users","signup").trigger({input:arguments,output:!1}),new Error(name+" -> Register: "+i.uid+" must be defined.")
if(!e.password)throw r(o,e,"Invalid submission. Password required."),i.event("SUM","users","signup").trigger({input:arguments,output:!1}),new Error(name+" -> Register: 'password' is a required property")
i.users.exists(i.uid,e[i.uid])?(r(o,e,"That "+i.uid+" is already in use!"),i.event("SUM","users","signup").trigger({input:arguments,output:!1})):(e.password=n(e.password),e.joinedOn=new Date,e.lastUpdated=new Date,e.guid=btoa(""+1e12*Math.random()),i.users.add(e),sessionStorage.setItem(name+"-current-user",e.guid),r(t,e),i.event("SUM","users","signup").trigger({input:arguments,output:e}))},i.update=function(e,t,o){for(var u in e)"password"==u?i.users.edit("guid",t,u,n(e[u])):i.users.edit("guid",t,u,e[u])
i.users.edit("guid",t,"lastUpdated",new Date),r(o,e,"Successfully updated user!"),i.event("SUM","users","update").trigger({input:arguments,output:e})},i.auth=function(e,t,o){if(!e[i.uid])throw r(o,e,"Invalid authentication attempt. "+i.uid+" required."),i.event("SUM","users","authenticate").trigger({input:arguments,output:!1}),new Error(name+" -> Auth: "+i.uid+" must be defined.")
if(!e.password)throw r(o,e,"Invalid authentication attempt. Password required."),i.event("SUM","users","authenticate").trigger({input:arguments,output:!1}),new Error(name+" -> Auth: 'password' is a required property")
i.users.exists(i.uid,e[i.uid])?i.users.get(i.uid,e[i.uid]).password==n(e.password)?(r(t,e),i.event("SUM","users","authenticate").trigger({input:arguments,output:e})):(r(o,e,"Incorrect password!"),i.event("SUM","users","authenticate").trigger({input:arguments,output:!1})):(r(o,e,"User does not exist!"),i.event("SUM","users","authenticate").trigger({input:arguments,output:!1}))},i.login=function(e,t,n){i.auth(e,function(e){var n=i.users.get(i.uid,e.data[i.uid])
sessionStorage.setItem(name+"-current-user",n.guid),r(t,e.data,"Login successfull!"),i.event("SUM","users","login").trigger({input:arguments,output:e})},function(e){r(n,e.data,"Login failed!"),i.event("SUM","users","login").trigger({input:arguments,output:!1})})},i.logout=function(e){sessionStorage.removeItem(name+"-current-user"),window.location.href=e,i.event("SUM","users","logout").trigger({input:arguments,output:null})},i.loggedInAs=function(){return sessionStorage.getItem(name+"-current-user")||"User"},i.loggedIn=function(){return null!=sessionStorage.getItem(name+"-current-user")},i.currentUser=function(){return i.users.get("guid",i.loggedInAs())},i.deleteUserAccount=function(e,t,n){i.auth(e,function(e){sessionStorage.setItem(name+"-current-user",e.data[i.uid]),i.users.remove(i.uid,e[i.uid]),r(t,e.data,"User deleted!"),i.event("SUM","users","delete").trigger({input:arguments,output:e})},function(e){r(n,e.data,"User does not exist!"),i.event("SUM","users","delete").trigger({input:arguments,output:!1})})},i.getProfilePictureData=function(e){return localStorage.getItem(i.name+"-profilepic-"+(e||i.loggedInAs()))||!1},i.reset=function(){localStorage.clear(),sessionStorage.clear(),window.location.href=window.location.href,i.event("SUM","reset").trigger({input:arguments,output:null})},i.setSecurityQuestion=function(e,t){var r=i.loggedInAs()
return!!r&&(i.users.update("guid",r,"SQ",e),i.users.update("guid",r,"SQA",n(t)),i.event("SUM","users","setSecurityQuestion").trigger({input:arguments,output:!0}),!0)},i.forgotPassword=function(e,t,o,u,s){if(i.users.exists(i.uid,e)){var a=i.users.get(i.uid,e)
a.SQA===n(t)?(i.users.update(i.uid,e,"password",o),a=i.users.get(i.uid,e),r(u,a,"Successfully changed password!"),i.event("SUM","users","forgotPassword").trigger({input:arguments,output:a})):(r(s,{},"Wrong answer."),i.event("SUM","users","forgotPassword").trigger({input:arguments,output:!1}))}else r(s,{},"That "+i.uid+" isn't used in this application."),i.event("SUM","users","forgotPassword").trigger({input:arguments,output:!1})},i.getForm=function(e){var t={},n=e.elements
for(var r in n){var i=n[r],o=n[r].tagName,u=n[r].name
if("INPUT"==o||"SELECT"==o||"TEXTAREA"==o){var s=o+r,a=u||(i.id||s)
a.toLowerCase().match("submit")||a.toLowerCase().match("confirm")||(t[a]=i.value)}}return t},i.newComponent=function(e,t,n,r){i.Q(t).forEach(function(e){n(e)})
var o={name:e,id:btoa(e+t+Math.floor(1e3*Math.random())),selector:t,operation:n.toString(),description:r||""}
i.extentions.exists("name",e)?i.extentions.exists("name",e)&&(i.extentions.Update(o),i.event("SUM","updateComponent").trigger({input:arguments,output:o})):(i.extentions.add(o),i.event("SUM","newComponent").trigger({input:arguments,output:o}))}
var u={}
i.generateView=function(e,t,n){u[e]?n=u[e]:(n=n||(e.innerHTML||""),u[e]=n),e.innerHTML="",t=t||[],t.forEach(function(t){var r=n
for(var i in t)r=r.split("$"+i).join(t[i])
e.innerHTML+=r}),i.event("SUM","users","generateView").trigger({input:arguments,output:null}),e.querySelectorAll("[from-storage]").forEach(function(e){var t=new o(e.tagName)
i.generateView(e,t.listAll())})},i.parseURL=function(e){var t=window.location.href,n={}
if("check"===(e=e&&("?"===e||"#"===e)?e:"check")&&!1===(e=t.includes("?")?"?":!!t.includes("#")&&"#"))return!1
if(t=t.substring(t.indexOf(e)+1,t.length),t.includes("=")){var r=t.split("&")
return r.forEach(function(e){n[e.split("=")[0]]=e.split("=")[1]}),r[0].split("=").length>1?n:t}return t},i.searchContext=function(e,t){function n(e,t){return e=e.toLowerCase(),t=t.toLowerCase(),e.includes(t)}var r=(t||document.body).innerHTML,i=window.location.href,o=document.querySelector("title")
return o=null!=o?o.innerHTML:"",n(i,e)||n(r,e)||n(o,e)},i.run=function(){function e(e,n){i.files.exists("name",t.name)?i.files.edit("name",t.name,e,n):i.files.add(t)}i.event("SUM","run","before").trigger({input:arguments,output:null})
var t=function(){var e=window.location.href
e=e.split("/")
var t=e[e.length-2]
return e=e[e.length-1],e=e.split("#")[0],{name:e.split("?")[0],folder:t,forms:""}}()
e("folder",t.folder)
var n=[]
i.newComponent("from-url","[from-url]",function(e){var t=e.getAttribute("from-url"),n=t.split(/\s/).join("").split(","),r=i.parseURL()
n.forEach(function(t){var n=t.split(":")
"text"==n[0]?e.innerHTML=r[n[1]]:e.setAttribute(n[0],r[n[1]])})},'Set attributes to values defined in the URL. Syntax: "attribute: value, attribute: value".')
var r=document.querySelectorAll("form")
r.forEach(function(e){var t=e.getAttribute("type")
if(null==t&&1===r.length)if(i.searchContext("login")||i.searchContext("signin"))t="login",console.log("Deduced: ",t)
else if(i.searchContext("singup")||i.searchContext("register"))t="signup",console.log("Deduced: ",t)
else{if(!i.searchContext("update")&&!i.searchContext("change"))return
t="update",console.log("Deduced: ",t)}if("signup"===t&&localStorage.setItem(name+"-blueprint",JSON.stringify(i.getForm(e))),e.addEventListener("submit",function(n){var r=i.getForm(e),o=e.getAttribute("uid")
null!=o&&(i.uid=o,localStorage.setItem(i.name+"uid",o)),"login"===t||"signup"===t?(n.preventDefault(),i[t](r,e.getAttribute("on-success")||window.location.href,e.getAttribute("on-fail")||window.location.href)):"update"===t&&(n.preventDefault(),i.update(r,i.loggedInAs(),e.getAttribute("on-success")||window.location.href))}),"update"===t){var o=i.currentUser()
for(var u in o)e.querySelectorAll("#"+u+", [name='"+u+"']").forEach(function(e){"password"!=u&&e.setAttribute("value",o[u])})}var s=[],a=i.getForm(e)
for(var u in a)s.push(u)
n.push({type:t,fields:s})}),e("forms",JSON.stringify(n)),i.newComponent("Logout","[logout]",function(e){e.addEventListener("click",function(t){i.logout(e.getAttribute("logout")||window.location.href)})},"Logout the user when clicked."),i.newComponent("Delete User","[delete-user-account]",function(e){i.deleteUserAccount(e.getAttribute("delete-user-account")?e.getAttribute("delete-user-account"):i.loggedInAs(),e.getAttribute("on-success")||window.location.href,e.getAttribute("on-fail")||window.location.href)},"Delete user account when clicked.")
var u=i.currentUser()
for(var s in u)i.newComponent(s,s,function(e){e.innerHTML=u[s]},"Display "+s+" value of the user that is logged in.")
i.newComponent("Display Users","users",function(e){i.generateView(e,i.users.listAll())},"For each user, display the innerHTML of the given element after replacing each $propertyName with its value."),i.newComponent("Display stored data","[from-storage]",function(e){var t=new o(e.tagName)
i.generateView(e,t.listAll())},"For each object stored in the given collection, display the innerHTML of the given element after replacing each $propertyName with its value."),i.newComponent("App name","app-name",function(e){e.innerHTML=i.name},"Display app name.")
var a=function(e){var t=e.target,n=new FileReader
n.onload=function(){var e=n.result
localStorage.setItem(i.name+"-profilepic-"+i.loggedInAs(),e),i.Q("[profile-pic=''], [profile-pic='"+i.loggedInAs()+"']").forEach(function(t){t.setAttribute("src",e)})},n.readAsDataURL(t.files[0])}
i.newComponent("Upload Profile Picture","[upload='profile-pic']",function(e){e.setAttribute("type","file"),e.setAttribute("accept","image/*"),e.addEventListener("change",function(e){a(e)})},"Set up the given input element to upload the profile picture for the user that is logged in."),i.newComponent("Profile Picture","[profile-pic]",function(e){var t,n=e.getAttribute("profile-pic")||!1
t=""==n?i.loggedInAs():i.users.exists(i.uid,n)?i.users.get(i.uid,n).guid:"",i.getProfilePictureData(t)&&e.setAttribute("src",i.getProfilePictureData(t))},"Display profile picture for the user that is specified, or if set to nothing the user that is logged in."),i.event("SUM","run","after").trigger({input:arguments,output:null})},i.Q("html")[0].getAttribute("require-login")&&(i.loggedIn()||(window.location.href=e.loggedOut?e.loggedOut:i.Q("html")[0].getAttribute("require-login"))),i.Q("html")[0].getAttribute("logged-in")&&i.loggedIn()&&(window.location.href=e.loggedIn?e.loggedIn:i.Q("html")[0].getAttribute("logged-in")),void 0===t&&this.run()}window.app=new SUM
