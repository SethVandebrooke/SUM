function SUM(t,e){var n,o,r=this;function a(t){return(new(function(){function t(){}return t.hash=function(e,n){var o,r=Object.assign({msgFormat:"string",outFormat:"hex"},n);switch(r.msgFormat){default:case"string":e=function(t){try{return(new TextEncoder).encode(t,"utf-8").reduce(function(t,e){return t+String.fromCharCode(e)},"")}catch(e){return unescape(encodeURIComponent(t))}}(e);break;case"hex-bytes":e=""==(o=e.replace(" ",""))?"":o.match(/.{2}/g).map(function(t){return String.fromCharCode(parseInt(t,16))}).join("")}for(var a=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],i=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],s=(e+=String.fromCharCode(128)).length/4+2,u=Math.ceil(s/16),l=new Array(u),c=0;u>c;c++){l[c]=new Array(16);for(var d=0;16>d;d++)l[c][d]=e.charCodeAt(64*c+4*d+0)<<24|e.charCodeAt(64*c+4*d+1)<<16|e.charCodeAt(64*c+4*d+2)<<8|e.charCodeAt(64*c+4*d+3)<<0}var g=8*(e.length-1)/Math.pow(2,32),f=8*(e.length-1)>>>0;l[u-1][14]=Math.floor(g),l[u-1][15]=f;for(c=0;u>c;c++){for(var p=new Array(64),h=0;16>h;h++)p[h]=l[c][h];for(h=16;64>h;h++)p[h]=t.a1(p[h-2])+p[h-7]+t.a0(p[h-15])+p[h-16]>>>0;var m=i[0],v=i[1],b=i[2],S=i[3],w=i[4],A=i[5],y=i[6],U=i[7];for(h=0;64>h;h++){var M=U+t.a1(w)+t.Ch(w,A,y)+a[h]+p[h],I=t.a0(m)+t.Maj(m,v,b);U=y,y=A,A=w,w=S+M>>>0,S=b,b=v,v=m,m=M+I>>>0}i[0]=i[0]+m>>>0,i[1]=i[1]+v>>>0,i[2]=i[2]+b>>>0,i[3]=i[3]+S>>>0,i[4]=i[4]+w>>>0,i[5]=i[5]+A>>>0,i[6]=i[6]+y>>>0,i[7]=i[7]+U>>>0}for(U=0;U<i.length;U++)i[U]=("00000000"+i[U].toString(16)).slice(-8);var C="hex-w"==r.outFormat?" ":"";return i.join(C)},t.ROTR=function(t,e){return e>>>t|e<<32-t},t.a0=function(e){return t.ROTR(2,e)^t.ROTR(13,e)^t.ROTR(22,e)},t.a1=function(e){return t.ROTR(6,e)^t.ROTR(11,e)^t.ROTR(25,e)},t.a0=function(e){return t.ROTR(7,e)^t.ROTR(18,e)^e>>>3},t.a1=function(e){return t.ROTR(17,e)^t.ROTR(19,e)^e>>>10},t.Ch=function(t,e,n){return t&e^~t&n},t.Maj=function(t,e,n){return t&e^t&n^e&n},t}())).__proto__.constructor.hash(t)}function i(t,e,n){if(t)if("string"==typeof t)window.location.href=t;else if("function"==typeof t){t({data:e,message:n})}}t=t||{},r.name=t.name||"defaultApp",r.uid=t.uid||"username",null!=localStorage.getItem(r.name+"uid")&&(r.uid=localStorage.getItem(r.name+"uid")),r.Q=function(t){return document.querySelectorAll(t)},r.extentions=null,r.files=null,r.users=function(){function t(t){if(this.name=t,this.dataSystem={set:function(t,e){return localStorage.setItem(t,e)},get:function(t){return localStorage.getItem(t)}},this.name=t,null==this.dataSystem.get(t)){var e=new Array;this.dataSystem.set(t,JSON.stringify(e))}this.debug=!1,this.add=function(t){var e=JSON.parse(this.dataSystem.get(this.name));e.push(t),this.dataSystem.set(this.name,JSON.stringify(e)),!0===this.debug&&console.log(this.name+" -> add: Object successfully added!"),r.event("SUM","storage",this.name,"add").broadcast({input:t,output:null}),r.event("SUM","storage","add").broadcast({input:t,output:null})},this.exists=function(t,e){var n=JSON.parse(this.dataSystem.get(this.name));if(n.length>0){for(var o=0;o<n.length;o++){if(n[o][t]==e)return!0===this.debug&&console.log(this.name+" -> exists: returned true"),!0}this.dataSystem.set(this.name,JSON.stringify(n))}else!0===this.debug&&console.log(this.name+" -> exists: No objects are stored!")},this.edit=function(t,e,n,o){var a=JSON.parse(this.dataSystem.get(this.name));if(a.length>0){for(var i=0;i<a.length;i++){var s=a[i];s[t]==e&&(!0===this.debug&&(console.log(this.name+" -> edit: Object before - "),console.log(s)),s[n]=o,!0===this.debug&&(console.log(this.name+" -> edit: Object after - "),console.log(s)),a[i]=s,!0===this.debug&&console.log(this.name+" -> edit: Object saved!")),r.event("SUM","storage",this.name,"exists").broadcast({input:arguments,output:s}),r.event("SUM","storage","exists").broadcast({input:arguments,output:s})}this.dataSystem.set(this.name,JSON.stringify(a))}else!0===this.debug&&console.log(this.name+" -> edit: No objects are stored!");r.event("SUM","storage",this.name,"exists").broadcast({input:arguments,output:!1}),r.event("SUM","storage","exists").broadcast({input:arguments,output:!1})},this.remove=function(t,e){var n=JSON.parse(this.dataSystem.get(this.name));if(n.length>0){for(var o=0;o<n.length;o++){var a=n[o];a[t]==e&&(!0===this.debug&&(console.log(this.name+" -> remove: Object matched for removal -"),console.log(a)),n.splice(o,1),!0===this.debug&&console.log(this.name+" -> remove: Object deleted!")),r.event("SUM","storage",this.name,"remove").broadcast({input:arguments,output:a}),r.event("SUM","storage","remove").broadcast({input:arguments,output:a})}this.dataSystem.set(this.name,JSON.stringify(n))}else!0===this.debug&&console.log(this.name+" -> remove: No objects are stored!");r.event("SUM","storage",this.name,"remove").broadcast({input:arguments,output:!1}),r.event("SUM","storage","remove").broadcast({input:arguments,output:!1})},this.get=function(t,e){for(var n=JSON.parse(this.dataSystem.get(this.name)),o=0;o<n.length;o++){var a=n[o];if(a[t]==e)return!0===this.debug&&(console.log(this.name+" -> get: Object found! "),console.log(a)),a}return r.event("SUM","storage",this.name,"get").broadcast({input:arguments,output:a}),r.event("SUM","storage","get").broadcast({input:arguments,output:a}),!0===this.debug&&console.log(this.name+" -> get: Object not found!"),n.length<1&&!0===this.debug&&console.log(this.name+" -> get: No objects, with the property of "+t+", matched "+e),null},this.listAll=function(){var t=JSON.parse(this.dataSystem.get(this.name));return r.event("SUM","storage",this.name,"listAll").broadcast({input:arguments,output:t}),r.event("SUM","storage","listAll").broadcast({input:arguments,output:t}),t.length<1&&!0===this.debug&&console.log(this.name+" -> listAll: There are no stored objects to return!"),!0===this.debug&&(console.log(this.name+" -> listAll: Objects were found!"),console.log(t)),t},this.clear=function(){r.event("SUM","storage",this.name,"clear","before").broadcast({input:arguments,output:null}),r.event("SUM","storage","clear","before").broadcast({input:arguments,output:null}),this.dataSystem.clear(),r.event("SUM","storage",this.name,"clear","after").broadcast({input:arguments,output:null}),r.event("SUM","storage","clear","after").broadcast({input:arguments,output:null})},this.update=function(t,e,n){for(var o in n)this.edit(t,e,o,n[o]);r.event("SUM","storage",this.name,"update").broadcast({input:arguments,output:null}),r.event("SUM","storage","update").broadcast({input:arguments,output:null})},this.filter=function(t){var e=this.listAll().filter(t);return r.event("SUM","storage",this.name,"filter").broadcast({input:arguments,output:e}),r.event("SUM","storage","filter").broadcast({input:arguments,output:e}),e},this.getFormData=function(t){var e={},n=t.elements;for(var o in n){var r=n[o],a=n[o].tagName,i=n[o].name;if("INPUT"==a||"SELECT"==a||"TEXTAREA"==a){var s=a+o,u=i||(r.id||s);u.toLowerCase().match("submit")||u.toLowerCase().match("confirm")||(e[u]=r.value)}}return e},this.addFromForm=function(t){var e=this.getFormData(t);e.createdOn=new Date,e.lastUpdated=new Date,e.guid=btoa(1e8*math.random()+""),e.createdBy=r.currentUser().guid,this.add(e)},this.attatchToForm=function(t){var e=this,n=t.getAttribute("method");if("add"==n)t.addEventListener("submit",function(t){t.preventDefault(),e.addFromForm(t.target)});else if("update"==n&&(t.addEventListener("submit",function(t){t.preventDefault();var n=t.target.getAttribute("field"),o=t.target.getAttribute("value");e.updateForm(t.target,n,o)}),"true"==t.getAttribute("prefill"))){var o=t.getAttribute("field"),r=t.getAttribute("value");this.prefillForm(t,this.get(o,r))}},this.prefillForm=function(t,e){for(var n in e)t.querySelectorAll("#"+n+", [name='"+n+"']").forEach(function(t){"password"!=n&&(t.value=e[n])})},this.updateForm=function(t,e,n){t=this.getFormData(t);for(var o in t)this.edit(e,n,o,t[o])}}return r.files=new t(r.name+"-files"),r.extentions=new t(r.name+"-extensions"),document.querySelectorAll("form").forEach(function(e){var n=e.getAttribute("store-as")||!1;n&&new t(n).attatchToForm(e)}),n=t,new t(r.name+"-app-data")}(),r.extentions.Update=function(t){r.extentions.update("name",t.name,t)},r.event=(o={},function(){var t=Array.from(arguments),e=1===t.length,n=t.join("/");return o.hasOwnProperty(n)||(o[n]=[]),{listen:function(t){return o[n].push(t),t},broadcast:function(){var t=Array.from(arguments);for(var r in o)e?r!==n&&null===r.match(n+"/")||o[r].forEach(function(e){e.apply(null,t)}):null!==r.match(n)&&o[r].forEach(function(e){e.apply(null,t)})},stopListening:function(t){for(var e in o)if(null!==e.match(n))for(var r in o[n])t.toString()==o[n][r].toString()&&o[n].splice(r,1)}}}),r.signup=function(t,e,n){if(!t[r.uid])throw i(n,t,"Invalid submission. "+r.uid+" required."),r.event("SUM","users","signup").broadcast({input:arguments,output:!1}),new Error(name+" -> Register: "+r.uid+" must be defined.");if(!t.password)throw i(n,t,"Invalid submission. Password required."),r.event("SUM","users","signup").broadcast({input:arguments,output:!1}),new Error(name+" -> Register: 'password' is a required property");r.users.exists(r.uid,t[r.uid])?(i(n,t,"That "+r.uid+" is already in use!"),r.event("SUM","users","signup").broadcast({input:arguments,output:!1})):(t.password=a(t.password),t.joinedOn=new Date,t.lastUpdated=new Date,t.guid=btoa(""+1e12*Math.random()),r.users.add(t),sessionStorage.setItem(name+"-current-user",t.guid),i(e,t),r.event("SUM","users","signup").broadcast({input:arguments,output:t}))},r.update=function(t,e,n){for(var o in t)"password"==o?o.length>0&&o.replace(/\s+/g,"")!=o&&r.users.edit("guid",e,o,a(t[o])):r.users.edit("guid",e,o,t[o]);r.users.edit("guid",e,"lastUpdated",new Date),i(n,t,"Successfully updated user!"),r.event("SUM","users","update").broadcast({input:arguments,output:t})},r.auth=function(t,e,n){if(!t[r.uid])throw i(n,t,"Invalid authentication attempt. "+r.uid+" required."),r.event("SUM","users","authenticate").broadcast({input:arguments,output:!1}),new Error(name+" -> Auth: "+r.uid+" must be defined.");if(!t.password)throw i(n,t,"Invalid authentication attempt. Password required."),r.event("SUM","users","authenticate").broadcast({input:arguments,output:!1}),new Error(name+" -> Auth: 'password' is a required property");r.users.exists(r.uid,t[r.uid])?r.users.get(r.uid,t[r.uid]).password==a(t.password)?(i(e,t),r.event("SUM","users","authenticate").broadcast({input:arguments,output:t})):(i(n,t,"Incorrect password!"),r.event("SUM","users","authenticate").broadcast({input:arguments,output:!1})):(i(n,t,"User does not exist!"),r.event("SUM","users","authenticate").broadcast({input:arguments,output:!1}))},r.login=function(t,e,n){r.auth(t,function(t){var n=r.users.get(r.uid,t.data[r.uid]);sessionStorage.setItem(r.name+"-current-user",n.guid);var o=a(n.guid+t.password+Math.random());sessionStorage.setItem(r.name+"-auth-token",o),localStorage.setItem(r.name+"-auth-token",a(o)),i(e,t.data,"Login successfull!"),r.event("SUM","users","login").broadcast({input:arguments,output:t})},function(t){i(n,t.data,"Login failed!"),r.event("SUM","users","login").broadcast({input:arguments,output:!1})})},r.logout=function(t){sessionStorage.removeItem(r.name+"-current-user"),sessionStorage.removeItem(r.name+"-auth-token"),localStorage.removeItem(r.name+"-auth-token"),window.location.href=t,r.event("SUM","users","logout").broadcast({input:arguments,output:null})},r.loggedInAs=function(){return!!r.loggedIn&&sessionStorage.getItem(r.name+"-current-user")},r.loggedIn=function(){var t=r.users.get("guid",sessionStorage.getItem(r.name+"-current-user")),e=a(sessionStorage.getItem(r.name+"-auth-token"))==localStorage.getItem(r.name+"-auth-token");return t&&e},r.currentUser=function(){return r.loggedIn()?r.users.get("guid",r.loggedInAs()):{}},r.deleteUserAccount=function(t,e,n){r.auth(t,function(t){sessionStorage.setItem(name+"-current-user",t.data[r.uid]),r.users.remove(r.uid,t[r.uid]),i(e,t.data,"User deleted!"),r.event("SUM","users","delete").broadcast({input:arguments,output:t})},function(t){i(n,t.data,"User does not exist!"),r.event("SUM","users","delete").broadcast({input:arguments,output:!1})})},r.getProfilePictureData=function(t){return localStorage.getItem(r.name+"-profilepic-"+(t||r.loggedInAs()))||!1},r.reset=function(){localStorage.clear(),sessionStorage.clear(),window.location.href=window.location.href,r.event("SUM","reset").broadcast({input:arguments,output:null})},r.setSecurityQuestion=function(t,e){var n=r.loggedInAs();return!!n&&(r.users.update("guid",n,"SQ",t),r.users.update("guid",n,"SQA",a(e)),r.event("SUM","users","setSecurityQuestion").broadcast({input:arguments,output:!0}),!0)},r.forgotPassword=function(t,e,n,o,s){if(r.users.exists(r.uid,t)){var u=r.users.get(r.uid,t);u.SQA===a(e)?(r.users.update(r.uid,t,"password",n),i(o,u=r.users.get(r.uid,t),"Successfully changed password!"),r.event("SUM","users","forgotPassword").broadcast({input:arguments,output:u})):(i(s,{},"Wrong answer."),r.event("SUM","users","forgotPassword").broadcast({input:arguments,output:!1}))}else i(s,{},"That "+r.uid+" isn't used in this application."),r.event("SUM","users","forgotPassword").broadcast({input:arguments,output:!1})},r.getForm=function(t){var e={},n=t.elements;for(var o in n){var r=n[o],a=n[o].tagName,i=n[o].name;if("INPUT"==a||"SELECT"==a||"TEXTAREA"==a){var s=a+o,u=i||(r.id||s);u.toLowerCase().match("submit")||u.toLowerCase().match("confirm")||(e[u]=r.value)}}return e},r.newComponent=function(t,e,n,o){r.Q(e).forEach(function(t){n(t)});var a={name:t,id:btoa(t+e+Math.floor(1e3*Math.random())),selector:e,operation:n.toString(),description:o||""};r.extentions.exists("name",t)?r.extentions.exists("name",t)&&(r.extentions.Update(a),r.event("SUM","updateComponent").broadcast({input:arguments,output:a})):(r.extentions.add(a),r.event("SUM","newComponent").broadcast({input:arguments,output:a}))};var s={};r.generateView=function(t,e,o){s[t]?o=s[t]:(o=o||(t.innerHTML||""),s[t]=o),t.innerHTML="",(e=e||[]).forEach(function(e){var n=o;for(var r in e)n=n.split("$"+r).join(e[r]);t.innerHTML+=n}),r.event("SUM","users","generateView").broadcast({input:arguments,output:null}),t.querySelectorAll("[from-storage]").forEach(function(t){var e=new n(t.tagName);r.generateView(t,e.listAll())})},r.parseURL=function(t){var e=window.location.href,n={};if("check"===(t=t&&("?"===t||"#"===t)?t:"check")&&!1===(t=e.includes("?")?"?":!!e.includes("#")&&"#"))return!1;if((e=e.substring(e.indexOf(t)+1,e.length)).includes("=")){var o=e.split("&");return o.forEach(function(t){n[t.split("=")[0]]=t.split("=")[1]}),o[0].split("=").length>1?n:e}return e},r.searchContext=function(t,e){var n=e?e.innerHTML:"",o=window.location.href,r=document.querySelector("title");r=r?r.innerHTML:"";var a=e&&e.getAttribute("id")||"",i=0;function s(t,e){return t=t.toLowerCase(),e=e.toLowerCase(),t.split(e).length-1}i=5*s(o,t),i+=6*s(a,t),i+=3*s(n,t),i+=4*s(r,t);var u=0;document.body.querySelectorAll("h1,h2,h3,h4,h5,h6").forEach(function(e){u+=s(e.innerHTML,t)}),u*=2;var l=0;return document.body.querySelectorAll("p").forEach(function(e){l+=s(e.innerHTML,t)}),i+=u+l},r.run=function(){r.event("SUM","run","before").broadcast({input:arguments,output:null});var t,e,o=(t=window.location.href,e=(t=t.split("/"))[t.length-2],{name:(t=(t=t[t.length-1]).split("#")[0]).split("?")[0],folder:e,forms:""});function a(t,e){r.files.exists("name",o.name)?r.files.edit("name",o.name,t,e):r.files.add(o)}a("folder",o.folder);var i=[];r.newComponent("from-url","[from-url]",function(t){var e=t.getAttribute("from-url").split(/\s/).join("").split(","),n=r.parseURL();e.forEach(function(e){var o=e.split(":");"text"==o[0]?t.innerHTML=n[o[1]]:t.setAttribute(o[0],n[o[1]])})},'Set attributes to values defined in the URL. Syntax: "attribute: value, attribute: value".');var s=document.querySelectorAll("form");s.forEach(function(t){var e=t.getAttribute("type");if(null==e&&1===s.length){var n=r.searchContext("login",t)+r.searchContext("signin",t)+r.searchContext("sign in",t),o=r.searchContext("signup",t)+r.searchContext("sign up",t)+r.searchContext("register",t),a=r.searchContext("update",t)+r.searchContext("edit",t)+r.searchContext("change",t),u=n+o+a;if(n>o&&n>a)e="login",console.log("Deduced: ",e,n/u*100+"% Probability");else if(o>n&&o>a)e="signup",console.log("Deduced: ",e,o/u*100+"% Probability");else if(a>o&&a>n)e="update",console.log("Deduced: ",e,a/u*100+"% Probability");else{if(n!==o)return void console.log("SUM is unsure as to what this form is intended for: ",t);t.querySelectorAll("input").length>3?(e="signup",console.log("Deduced: ",e,"70% Probability")):(e="login",console.log("Deduced: ",e,"70% Probability"))}}if("signup"===e&&localStorage.setItem(name+"-blueprint",JSON.stringify(r.getForm(t))),t.addEventListener("submit",function(n){var o=r.getForm(t),a=t.getAttribute("uid");null!=a&&(r.uid=a,localStorage.setItem(r.name+"uid",a)),"login"===e||"signup"===e?(n.preventDefault(),r[e](o,t.getAttribute("on-success")||window.location.href,t.getAttribute("on-fail")||window.location.href)):"update"===e&&(n.preventDefault(),r.update(o,r.loggedInAs(),t.getAttribute("on-success")||window.location.href))}),"update"===e){var l=r.currentUser();for(var c in l)t.querySelectorAll("#"+c+", [name='"+c+"']").forEach(function(t){"password"!=c&&t.setAttribute("value",l[c])})}var d=[],g=r.getForm(t);for(var c in g)d.push(c);i.push({type:e,fields:d})}),a("forms",JSON.stringify(i)),r.newComponent("Logout","[logout]",function(t){t.addEventListener("click",function(e){r.logout(t.getAttribute("logout")||window.location.href)})},"Logout the user when clicked."),r.newComponent("Delete User","[delete-user-account]",function(t){r.deleteUserAccount(t.getAttribute("delete-user-account")?t.getAttribute("delete-user-account"):r.loggedInAs(),t.getAttribute("on-success")||window.location.href,t.getAttribute("on-fail")||window.location.href)},"Delete user account when clicked.");var u=r.currentUser();for(var l in u)r.newComponent(l,l,function(t){t.innerHTML=u[l]},"Display "+l+" value of the user that is logged in.");r.newComponent("Display Users","users",function(t){r.generateView(t,r.users.listAll())},"For each user, display the innerHTML of the given element after replacing each $propertyName with its value."),r.newComponent("Display stored data","[from-storage]",function(t){var e=new n(t.tagName);r.generateView(t,e.listAll())},"For each object stored in the given collection, display the innerHTML of the given element after replacing each $propertyName with its value."),r.newComponent("App name","app-name",function(t){t.innerHTML=r.name},"Display app name.");r.newComponent("Upload Profile Picture","[upload='profile-pic']",function(t){t.setAttribute("type","file"),t.setAttribute("accept","image/*"),t.addEventListener("change",function(t){var e,n;e=t.target,(n=new FileReader).onload=function(){var t=n.result;localStorage.setItem(r.name+"-profilepic-"+r.loggedInAs(),t),r.Q("[profile-pic=''], [profile-pic='"+r.loggedInAs()+"']").forEach(function(e){e.setAttribute("src",t)})},n.readAsDataURL(e.files[0])})},"Set up the given input element to upload the profile picture for the user that is logged in."),r.newComponent("Profile Picture","[profile-pic]",function(t){var e,n=t.getAttribute("profile-pic")||!1;e=""==n?r.loggedInAs():r.users.exists(r.uid,n)?r.users.get(r.uid,n).guid:"",r.getProfilePictureData(e)&&t.setAttribute("src",r.getProfilePictureData(e))},"Display profile picture for the user that is specified, or if set to nothing the user that is logged in."),r.event("SUM","run","after").broadcast({input:arguments,output:null})},r.Q("html")[0].getAttribute("require-login")&&(r.loggedIn()||(window.location.href=t.loggedOut?t.loggedOut:r.Q("html")[0].getAttribute("require-login"))),r.Q("html")[0].getAttribute("logged-in")&&r.loggedIn()&&(window.location.href=t.loggedIn?t.loggedIn:r.Q("html")[0].getAttribute("logged-in")),void 0===e&&this.run()}window.app=new SUM;
